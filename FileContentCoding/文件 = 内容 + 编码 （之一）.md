## 文件 = 内容 + 编码 （之一）

在目前主流的电脑系统中，所有的数据都可以看作一组二进制数所构成的具体的流。
如果你拿一个示波器去看，你是能够在主板的合适位置上观测到这一列数字的。
另一方面，这组数据的内容往往对应现实世界中的一张图像、或者是一段文字。
这就构成了一种两端的结构，一端是计算机要处理的物理世界，另一端是计算机的具体硬件，而把这两个具体端联系起来的，我们可以理解成是抽象的编码过程。
本文将解析这一过程。

---

- 本文将以图像编码为例，以 PowerShell （PS）网络响应为载体，使用 Python 语言进行数据处理，试图对这一转换过程进行简要的阐释；
- 另外，本文还将在该例子的语境下，试图对 Python 语言使用过程中，会经常遇到坑的文件编码问题之源头进行解释；
- 通过该例子，相信读者还会涉及一个非常有趣的领域，即计算机的文字编码系统，在中文文字引入之后，面临了怎样的麻烦，及其目前补丁式的解决方法所引起的巨大兼容性问题。

如果有耐心看完，也许你会和我一样，觉得目前使用的计算机系统，并没有看上去的那么简单和呆萌可爱。

## 图像篇

### 图像的概念--认知、矩阵与对象

由于本文将以图像的编码为例进行讨论，我们不妨对图像的定义稍加讨论。

- 以人眼的视角来说，图像是感光细胞对光线的反应，大脑的视觉皮层负责整理并认知这些光线所生成的“图像”，从中识别物体或提取丰富的语义信息。
  但遗憾的是，计算机无法复现这种认知图像或语义图像；
- 当我们在计算机的语境下说到“图像”，我们指的是电脑屏幕或画布表面上的一块由各种颜色有序排列而成的区域，我们比较习惯地先验地定义这是一个矩形区域。
  这个矩阵区域就是目前我们在一般语境下所指称的图像。目前计算机所处理的图像大多也是指的是这种图像，我们不妨将之更准确地称为矩阵图像；
- 而图像对象是计算机对矩阵图像的编码和抽象。
  同一张矩阵图像可以通过不同的编码技术生成`.jpg, .png, .tif`等等多种类型的图像编码序列，计算机系统对图像编码进行特定方式的封装，就会生成各种各样的图像对象。
  计算机所存储和操作的，就是这些图像对象。

不要觉得以上的维特根斯坦式的语义思辨是纯粹啰嗦无用的，因为经过这些分析之后，我们至少明确了对于图像的三种表达，分别是大脑认知的、假想矩阵的和计算机抽象算术的表达。
三种表达分别对应本文标题中的**内容、编码和文件**。

对于本文来说，较为现实的意义在于，经过以上分析之后，我们可以专注于图像矩阵的分析。
那么，在这个语义框架下，我们可以适当地对“编码”的概念进行细分和延拓，而不至于与认知过程的编码概念相混淆，同时也能够允许计算机中的图像对象具有自己的编码概念。

我承认我在这里暗示了后续对另外二种编码的探索，相当于给自己挖了一个深不见底的坑。
但是现在，请大家专注于“矩阵图像”而把其他的东西暂时忘掉。

对于矩形图像来说，我们可以自然而然地使用数学中“矩阵”的概念对它进行表示。

现在你可以利用面前的显示器为例进行理解。
当打开显示设置，你可以看到类似分辨率为`1920 x 1080`这样的数字，它代表你的显示器在横、纵两个方向分别具有`1920`、`1080`个像素。
现在将上面的内容想象成一张尺寸合适的图像，那么这张图像在屏幕上就拥有和屏幕尺寸相同的物理分辨率，分辨率的单位我们称为像素，也就是说，这张图像包含 `1920 x 1080`个像素。
由于显示技术和计算机二进制表示的原因，每个像素的颜色可以表示为`RGB`三个分量，每个分量是离散的，包含 256 个等级，比如`#FF0000`代表红色，`#00FF00`代表绿色等等。

因此，我们可以安全地说，矩阵图像至少应该包含这样一个三维矩阵，比如尺寸为 `3 x 1920 x 1080`的矩阵，它代表`1920 x 1080`个像素和`3`个颜色分量。
当然，这里并不是说矩阵图像一定是这样的矩阵，因为我们可以轻易地给颜色空间增加一个维度，例如透明度维度，它控制着图像对其“下”图像的透视程度，这样就成为了`4 x 1920 x 1080`这样的矩阵。

而我们的计算机系统，为了对矩阵图像进行有效存储，需要将之进行序列化，即将原本的矩阵，按照一定的顺序“拉直”形成一列数字。
这样我们只要事先约定“拉直”的方式，就可以方便地生成数字序列与图像矩阵之间的对应关系。

至此，我们已经可以将矩阵图像等价成一列数字，之后的工作将专注于对这一列数字进行编码。这一工作将等同于对矩阵图像本身进行编码。
