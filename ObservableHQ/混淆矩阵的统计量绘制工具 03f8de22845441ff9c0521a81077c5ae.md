# 混淆矩阵的统计量绘制工具

本文提供了一个简单易用的二分类混淆矩阵的统计量结果绘制工具，能够比较全面地绘制出分类模型在各种性能条件下的统计量分布。本工具对分类器所有可能的三个维度均设为可调的，这形成了可拖动的软件界面，方便使用者调整到自己想要的条件。另外，本软件还支持多种统计量的全局展示，

软件工具的开源地址如下：

[Confusion matrix computer (binary)](https://observablehq.com/@listenzcc/confusion-matrix-computer-binary)

---
- [混淆矩阵的统计量绘制工具](#混淆矩阵的统计量绘制工具)
  - [二阶混淆矩阵及其统计量](#二阶混淆矩阵及其统计量)
  - [混淆矩阵的值与分类器性能之间的关系](#混淆矩阵的值与分类器性能之间的关系)
  - [分类器的参数模拟](#分类器的参数模拟)
  - [条件概率的介入：正、负样本的比例](#条件概率的介入正负样本的比例)


## 二阶混淆矩阵及其统计量

二阶混淆矩阵（也称为误差矩阵）是在分类问题中用于评估模型性能的一种表格形式的工具。它对模型的分类结果进行了总结，可以帮助你了解模型在不同类别上的表现。假设你有一个二分类问题，其中包括两个类别：正类别（Positive）和负类别（Negative）混淆矩阵的构成如下：

![Untitled](%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E7%9A%84%E7%BB%9F%E8%AE%A1%E9%87%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7%2003f8de22845441ff9c0521a81077c5ae/Untitled.png)

![Untitled](%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E7%9A%84%E7%BB%9F%E8%AE%A1%E9%87%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7%2003f8de22845441ff9c0521a81077c5ae/Untitled%201.png)

各项的含义如下：

- True Positive (TP)：模型正确地将正类别样本预测为正类别。
- True Negative (TN)：模型正确地将负类别样本预测为负类别。
- False Positive (FP)：模型错误地将负类别样本预测为正类别（假正例）。
- False Negative (FN)：模型错误地将正类别样本预测为负类别（假负例）。

基于这些值，可以计算出一些统计量，这些统计量可以帮助你全面评估模型的性能，以便在需要时进行调整或比较不同模型的性能。本文对这些统计量进行全面的可视化，动态视图如下图所示。

![20231104-163623.gif](%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E7%9A%84%E7%BB%9F%E8%AE%A1%E9%87%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7%2003f8de22845441ff9c0521a81077c5ae/20231104-163623.gif)

[Confusion matrix](https://en.wikipedia.org/wiki/Confusion_matrix)

## 混淆矩阵的值与分类器性能之间的关系

混淆矩阵中的四个值（True Positive, True Negative, False Positive, False Negative）与分类器的性能密切相关，它们反映了分类器对正类别和负类别样本的分类能力。这些值对于评估分类器的性能至关重要。例如，假设你正在构建一个医学诊断系统，用于检测某种疾病。在这种情况下：

- TP 表示模型成功地将真正患有疾病的患者识别为阳性。
- TN 表示模型成功地将健康的患者识别为阴性。
- FP 表示模型错误地将健康的患者误诊为患病。
- FN 表示模型错误地将真正患有疾病的患者误诊为健康。

基于这些值，可以计算出许多评估指标，如准确率、精确率、召回率、F1分数等，这些指标可以提供关于分类器性能的更全面的信息。此外，混淆矩阵中的各项值之和确实保持不变，即：

$$
\begin{cases}
TP + FN = P \\
FP + TN = N
\end{cases}
$$

这是因为混淆矩阵涵盖了所有样本的分类情况，而总样本数是一个固定的值，不会改变。

## 分类器的参数模拟

由于分类器面对的样本无非是正样本或负样本，因此，我们总能用两个值来描述分类器的性能，它们分别代表分类器鉴别正、负样本的能力

$$
\begin{cases}
r_p = TP / P\\
r_n = TN / N
\end{cases}
$$

易见，$r_p, r_n \in(0, 1)$。本文建立的软件工具就是利用这一特点，使用网格模拟的方式构造了“无数”个分类器，它们的两个值均不相同，因此性能各异。由于两个值确定后，混合矩阵几乎就确定了，因此可以计算出统计量值。下图是对 f1score 值的模拟计算结果，每个网格代表一种分类器性能的可能性。

![Untitled](%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E7%9A%84%E7%BB%9F%E8%AE%A1%E9%87%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7%2003f8de22845441ff9c0521a81077c5ae/Untitled%202.png)

## 条件概率的介入：正、负样本的比例

但是我们需要注意到，混合矩阵还需要加入另一个因素才能够完全确定，那就是正、负样本的自然比例，

$$
\mathbb{P}(A) = \frac{P}{P+N}
$$

而某个样本被分类为正、负样本的概率是条件概率

$$
\mathbb{P}(\hat{A}) = r_p\mathbb{P}(A) + (1-r_n)\mathbb{P}(\bar{A})
$$

因此，在计算混淆矩阵时，我们需要引入另一变量，那就是正、负样本之间的比例。也就是说，本文的模拟是三维的，前两个维度分别是两个能力值，最后一个维度是正、负样本比例值。第三个维度会对统计量造成极大影响，如下图所示。

![正、负样本数量相同](%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E7%9A%84%E7%BB%9F%E8%AE%A1%E9%87%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7%2003f8de22845441ff9c0521a81077c5ae/Untitled%203.png)

正、负样本数量相同

![负样本是正样本的 5 倍](%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E7%9A%84%E7%BB%9F%E8%AE%A1%E9%87%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7%2003f8de22845441ff9c0521a81077c5ae/Untitled%204.png)

负样本是正样本的 5 倍

为了问题过于复杂，我将第三个维度设置为可调的，这形成了可拖动的软件界面，方便使用者调整到自己想要的条件。另外，本软件支持多种统计量展示，界面如下图所示。

![Untitled](%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E7%9A%84%E7%BB%9F%E8%AE%A1%E9%87%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7%2003f8de22845441ff9c0521a81077c5ae/Untitled%205.png)

![Untitled](%E6%B7%B7%E6%B7%86%E7%9F%A9%E9%98%B5%E7%9A%84%E7%BB%9F%E8%AE%A1%E9%87%8F%E7%BB%98%E5%88%B6%E5%B7%A5%E5%85%B7%2003f8de22845441ff9c0521a81077c5ae/Untitled%206.png)