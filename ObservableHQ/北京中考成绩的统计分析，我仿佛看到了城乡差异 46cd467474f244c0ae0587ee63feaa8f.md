# 北京中考成绩的统计分析，我仿佛看到了城乡差异

本文对 2023 年中考成绩分布，我仿佛看到了城乡差异。从成绩上看，北京的高中似乎只对东城、海淀、朝阳和西城区的初中生开放。其中，前 4 区的学生成绩明显优于其他区。另外，东城区没有海淀区名气这么大，但东城区的 CDF 曲线与另外三区之间有一定的间隔，说明这个区的学生成绩更高。

另外，在 625 分以上的学生中，他们“均匀”来自 18 个区的假设不能成立。这说明成绩好的区在高成绩方面有近乎垄断的优势。

本文涉及的理论内容见附件，本文的代码可见我 ObservableHQ 笔记本

[Beijing high school entrance exam](https://observablehq.com/@listenzcc/beijing-high-school-entrance-exam)

---
- [北京中考成绩的统计分析，我仿佛看到了城乡差异](#北京中考成绩的统计分析我仿佛看到了城乡差异)
  - [各分数线，海淀和 4 区学生占比](#各分数线海淀和-4-区学生占比)
  - [概率密度和累积概率分析](#概率密度和累积概率分析)
  - [卡方检验分析](#卡方检验分析)
  - [附录：概率质量是离散情况下的概率密度](#附录概率质量是离散情况下的概率密度)
  - [附录：累积分布函数](#附录累积分布函数)
  - [附录：卡方检验](#附录卡方检验)


## 各分数线，海淀和 4 区学生占比

从数据上看，纳入统计的分别是 **"东城区", "海淀区", "朝阳区", "西城区"**, "石景山区", "昌平区", "丰台区", "怀柔区", "经开区", "燕山区", "通州区", "大兴区", "密云区", "顺义区", "房山区", "门头沟区", "延庆区", "平谷区”，共计18个区。这些区的排列顺序是根据 2023 年中考的加权平均成绩从高到低排序的。由于从整体分布上看，前 4 个区的高成绩学生明显多于其他区，其中以海淀区为最高。

![Untitled](%E5%8C%97%E4%BA%AC%E4%B8%AD%E8%80%83%E6%88%90%E7%BB%A9%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%EF%BC%8C%E6%88%91%E4%BB%BF%E4%BD%9B%E7%9C%8B%E5%88%B0%E4%BA%86%E5%9F%8E%E4%B9%A1%E5%B7%AE%E5%BC%82%2046cd467474f244c0ae0587ee63feaa8f/Untitled.png)

因此，我计算了海淀和 4 区学生数量在每个分数段占全市的比例，如下图所示，其中的红色代表各个分段的 4 区占比，绿色代表各个分段的海淀区考生占比。可以看到这个比例是压倒性的，如果你不是这 4 个区的学生，那么你考过 600 分的概率小于 25%。

![Untitled](%E5%8C%97%E4%BA%AC%E4%B8%AD%E8%80%83%E6%88%90%E7%BB%A9%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%EF%BC%8C%E6%88%91%E4%BB%BF%E4%BD%9B%E7%9C%8B%E5%88%B0%E4%BA%86%E5%9F%8E%E4%B9%A1%E5%B7%AE%E5%BC%82%2046cd467474f244c0ae0587ee63feaa8f/Untitled%201.png)

## 概率密度和累积概率分析

我计算了各区和全市的按成绩的概率密度，由此计算出了累积概率，并且根据累积概率计算出了累积分布函数（CDF）曲线，如下图所示。其中灰色阴影曲线为全市范围的 CDF 曲线，在其上 4 条 CDF 曲线代表前 4 个区。

CDF 曲线代表的意义是**给出随机变量小于或等于某个特定取值的概率**。当CDF（累积分布函数）曲线向左上凸出时，它代表随机变量的概率密度函数（PDF）存在一个正的斜率。这通常意味着随机变量倾向于取较大的值，并且有较高的概率在这些较大的取值范围内。

- 在数学上，如果CDF曲线向左上凸出，这意味着随机变量的概率密度函数在该点附近有正的二阶导数。正的二阶导数表示PDF在该点附近呈现上升的趋势。
- 实际应用中，当一个随机变量的CDF曲线向左上凸出时，我们可以认为该随机变量具有一定的集中趋势，并且较大的取值相对更常见。即代表该区成绩高的学生更多。

从图中看到，前 4 区的学生成绩明显优于其他区。另外，东城区没有海淀区名气这么大，但东城区的 CDF 曲线与另外三区之间有一定的间隔，说明这个区的学生成绩更高。

![Untitled](%E5%8C%97%E4%BA%AC%E4%B8%AD%E8%80%83%E6%88%90%E7%BB%A9%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%EF%BC%8C%E6%88%91%E4%BB%BF%E4%BD%9B%E7%9C%8B%E5%88%B0%E4%BA%86%E5%9F%8E%E4%B9%A1%E5%B7%AE%E5%BC%82%2046cd467474f244c0ae0587ee63feaa8f/Untitled%202.png)

## 卡方检验分析

因为概率密度图较乱，难以看出什么结果，所以我对概率密度进行卡方分析，

![Untitled](%E5%8C%97%E4%BA%AC%E4%B8%AD%E8%80%83%E6%88%90%E7%BB%A9%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%EF%BC%8C%E6%88%91%E4%BB%BF%E4%BD%9B%E7%9C%8B%E5%88%B0%E4%BA%86%E5%9F%8E%E4%B9%A1%E5%B7%AE%E5%BC%82%2046cd467474f244c0ae0587ee63feaa8f/Untitled%203.png)

首先，我的原假设是每个分数段的 18 个区的概率密度值相互独立，服从均值和方差未知的正态分布

$$
x_i \in X \sim \mathcal{N}(\mu, \sigma^2)
$$

接下来，我对每个分数段的 18 个概率密度值进行计算，得到自由度为 18 的卡方值

$$
\mathcal{X}^2 = \sum_{i=1}^{18}\frac{(x_i - \hat{\mu})^2}{\hat{\sigma^2}}
$$

其中，$\hat{\mu}和\hat{\sigma^2}$分别代表均值和方差的最大似然估计。根据查表得显著的卡方值为 28.87。

$$
\mathcal{X}^2_{dof=18} = 28.87 | p\lt 0.05
$$

将该值映射到下图中可知，在 625 分以上的学生中，他们“均匀”来自 18 个区的假设不能成立。这说明成绩好的区在高成绩方面有近乎垄断的优势。

![Untitled](%E5%8C%97%E4%BA%AC%E4%B8%AD%E8%80%83%E6%88%90%E7%BB%A9%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%EF%BC%8C%E6%88%91%E4%BB%BF%E4%BD%9B%E7%9C%8B%E5%88%B0%E4%BA%86%E5%9F%8E%E4%B9%A1%E5%B7%AE%E5%BC%82%2046cd467474f244c0ae0587ee63feaa8f/Untitled%204.png)

## 附录：概率质量是离散情况下的概率密度

概率质量函数（Probability Mass Function, PMF）是用于描述离散随机变量的概率分布的函数。它定义了随机变量在每个可能取值上的概率。

对于一个离散随机变量 X，其概率质量函数 PMF(X) 可以表示为：

$$
PMF(X = x) = P(X = x)
$$

其中，$PMF(X = x)$ 表示随机变量 $X$ 等于某个特定取值 $x$ 的概率。

概率质量函数 $PMF(X)$ 必须满足以下两个性质：

1. 对于所有可能的取值 x，有 $0 \le PMF(X = x) \le 1$。
2. 所有可能取值的概率之和等于 1，即 $\sum_xPMF(X = x) = 1$。

概率质量函数在离散情况下为每个取值点提供了具体的概率值，因为离散随机变量只能取某些特定的离散值。通过概率质量函数，我们可以确定每个取值的概率，从而理解随机变量在各个取值上的分布情况。

## 附录：累积分布函数

概率质量函数（Probability Mass Function, PMF）描述了离散随机变量在每个可能取值上的概率。与之相关的是累积分布函数（Cumulative Distribution Function, CDF），它给出随机变量小于或等于某个特定取值的概率。

对于一个离散随机变量 X，其累积分布函数 CDF(X) 定义为：

$$
CDF(X \leq x) = P(X \leq x) = \sum_{t \leq x} \text{PMF}(X = t) 
$$

其中，$CDF(X \le x)$ 表示随机变量 $X$ 小于或等于某个特定取值 $x$ 的概率。

概率质量函数（PMF）和累积分布函数（CDF）是描述离散随机变量的两种常用方法。PMF给出每个离散取值的概率，而CDF给出了在某个取值及其之前所有可能取值的概率累积。通过理解和使用这两个函数，我们可以更好地了解随机变量的概率分布和性质。

## 附录：卡方检验

正态分布的平方和服从自由度为 2 的卡方分布。

具体来说，如果有 n 个来自标准正态分布的独立随机变量，即$Z_1, Z_2, \dots, Z_n$，那么它们的平方和 $\mathcal{X}^2 = Z_1^2 + Z_2^2 +  \dots + Z_n^2$ 将服从自由度为 n 的卡方分布。

在统计学中，卡方分布是一种特殊的概率分布，用于处理正态分布下方差的推断问题。在方差分析（ANOVA）和卡方检验中，经常涉及到卡方分布的性质和应用。