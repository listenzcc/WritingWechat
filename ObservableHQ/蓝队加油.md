## 蓝队加油

INTEL新近发布了第`12`代CPU，
在长时间挤牙膏之后，终于爆发了一次。
虽然没有了当前“默秒全”的统治力，
但新产品确实是让人大呼NB。

本文是十分应景的一文，
正好有一个良好的实验，
来说明“睿频”这个功能为计算资源的释放提供了怎样颠覆性的贡献。

----
- [蓝队加油](#蓝队加油)
- [立竿见影](#立竿见影)
- [CPU及其处理速率](#cpu及其处理速率)
- [睿频](#睿频)

## 立竿见影

在上文[乌合之众](http://mp.weixin.qq.com/s?__biz=MzkxNTI1MDc5NA==&mid=2247484701&idx=1&sn=789b5012993c70e16a8878a1d9f5af8e&chksm=c1634e18f614c70ec470d452b609281527b6da269d4af685440f68c9579660769c1fc4ff59fa&token=1555841918&lang=en_US#rd "乌合之众")中，
我们建立了一个“有限资源下的网络消息传递模型”。
通过实验可以看到，这样的网络在
“节点数量为$70$，消息生成数量为$7$”
的条件下，已经无法应付生成的消息。

而受到INTEL芯片“睿频”概念的启发，
我们只是给负载较重的“节点”临时增加一点处理能力，

> 允许拥堵节点在每次循环中处理`2`条消息，
> 而不是只能处理`1`个。

这样简单的改进取得了立竿见影的效果，

- 我们重新模拟了`70`节点，`7`消息的系统，效果如下

  【这是一段棒到不行的视频】
  视频中，有些节点会“时不时”地从白色变成黑色，
  代表这些节点刚刚临时增强了处理能力，
  处理了`2`个节点。

  增强效果是立竿见影的，
  我们的网络已经能够处理这种负载情况。

- 我们增加了一些负载，每次生成`10`个消息，效果如下

   【这是一段棒到不行的视频】
   可以看到，我们的网络已经也能够处理这种负载。

分析代码可见我的[代码笔记本](https://observablehq.com/@listenzcc/the-packages-tour-ii "代码笔记本")。

奇怪的是，
在这样的改进之后，
虽然网络的处理能力极大提高。
但网络中的节点并不需要时刻增加自己的计算能力，
只要根据需要“偶尔”增加即可。

现代的CPU正是使用了这样的技术，
我们的个人电脑才能够实现合理功耗条件下的高效计算。
简单来说，大家手上的电脑才变得越来越好用。

下面做简要的解释。

## CPU及其处理速率

CPU是电脑的核心处理单元，
几乎所有的逻辑计算都是由它完成的。
它算的越快，我们的电脑使用起来就越流畅。

它能算多快呢？
就是标称的`GHz`数，代表每秒完成`x 1,000,000,000`次计算。

计算虽快，但并非没有代价。
在物理上，计算等价于微电路的开断和充放电状态，
由于CPU中的电路不处于超导状态，
因此，这一过程会伴随热量的生成。
简单来说，算得越快，产热就越高。

目前主流CPU会在内部集成若干个处理核心，
这些核心可以理解成独立的小CPU核心。

一般说来，单个核心以几个单位的`Ghz`速度进行计算，
已经足以抵消一个嗡嗡作响的风扇所能带走的热量。
这就是电脑会配有风扇的原因。

但风扇解决不了所有问题，

- 首先，风扇会消耗大量的电能，很难集成到小型实用系统中；
- 更重要的是，CPU尺寸小，而产热大，风扇的物理尺寸做不到这么小。
  
  什么意思呢？
  比如我们要带走`45W`的热量，就需要`5 x 5`尺寸的风扇，
  而CPU只有`4 x 4`这么大，
  因此就至少有`1 x 1`这么多的热量散不出去，
  只会累积在CPU里。

针对这个问题，现代CPU采用睿频技术平衡性能与散热之间的平衡。

## 睿频

睿频其实说起来就是很简单的功能，
它可以分为几个部分，

- CPU平时以较低的频率运行，从而减小产热；
- 在大负载工作到达时，CPU拉高自身的计算频率，迅速完成任务；
- 在睿频状态下，虽然产热大，但好处是保持时间短，
  即使有热量累积，也能够在之后的平稳期将热量散发出去。

这样的策略有效吗？
答案是十分有效。
我们不说远的，
就说在之前的网络模拟中，
我们就通过加入简单的睿频功能，
不仅实现了网络性能的飞跃；
同时也不需要时刻保持在睿频状态。

当然，睿频已经是老黄历了，
新的`12`代CPU已经开始玩大小核了。

