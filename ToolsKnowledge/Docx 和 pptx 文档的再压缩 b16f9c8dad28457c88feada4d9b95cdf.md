# Docx 和 pptx 文档的再压缩

本文使用 P 颜色模式对图像进行压缩，并提供一个 gradio 工具实现 docx 和 pptx 文档的高度压缩。

[https://github.com/listenzcc/image-compress](https://github.com/listenzcc/image-compress)

---
- [Docx 和 pptx 文档的再压缩](#docx-和-pptx-文档的再压缩)
  - [P 颜色模式与图像压缩](#p-颜色模式与图像压缩)
  - [针对图像的压缩效果](#针对图像的压缩效果)
  - [针对文档的压缩方法和效果](#针对文档的压缩方法和效果)



## P 颜色模式与图像压缩

PILLOW 是一个 Python 图像处理库，它支持多种颜色模式，其中包括 RGB 和 P 模式。

1. RGB 模式：
    - RGB 代表红色 (Red)、绿色 (Green) 和蓝色 (Blue)。
    - 在 RGB 模式下，每个像素由三个通道组成，每个通道表示对应颜色的亮度。
    - 这是常见的彩色图像模式，用于表示彩色图像。
2. P 模式：
    - P 模式通常用于调色板或索引图像。
    - 在 P 模式下，图像中的每个像素不直接存储颜色值，而是存储一个索引，该索引对应于一个颜色调色板中的颜色。
    - 调色板是一个包含一组颜色的列表，而图像中的像素使用这些颜色的索引来表示其颜色。

通常情况下，P 模式用于节省内存和存储空间，特别是对于包含大量相似颜色的图像，比如简单的图标或简化的图像。RGB 模式则更适合彩色图像或需要精确表示颜色的情况。

## 针对图像的压缩效果

下图是压缩效果的统计图，其横坐标代表压缩比率，纵坐标代表图像内的颜色数量。下图中的左图代表颜色数量较少的图像，这类图像的压缩率约在 15% 以下；右图中的颜色数量较多的图像，这类图像的压缩率约为 20%。另外，还有一些图像的颜色空间更加复杂，这导致它们的压缩率在 20% 和 30% 之间，这个问题不在这里讨论。

![Untitled](Docx%20%E5%92%8C%20pptx%20%E6%96%87%E6%A1%A3%E7%9A%84%E5%86%8D%E5%8E%8B%E7%BC%A9%20b16f9c8dad28457c88feada4d9b95cdf/Untitled.png)

![Untitled](Docx%20%E5%92%8C%20pptx%20%E6%96%87%E6%A1%A3%E7%9A%84%E5%86%8D%E5%8E%8B%E7%BC%A9%20b16f9c8dad28457c88feada4d9b95cdf/Untitled%201.png)

![Untitled](Docx%20%E5%92%8C%20pptx%20%E6%96%87%E6%A1%A3%E7%9A%84%E5%86%8D%E5%8E%8B%E7%BC%A9%20b16f9c8dad28457c88feada4d9b95cdf/Untitled%202.png)

## 针对文档的压缩方法和效果

针对 docx 和 pptx 的文档，我使用 gradio 工具建立了一个 web 交互页面，通过 zipfile 对压缩文件进行操作，并将文件内的全部图片替换为压缩后的图片以实现高比率的压缩。该操作能够完成的原因是由于这类文档通常是具有固定格式的压缩文档，它似乎也没有校验需求，只通过文件名对图像内容进行识别。由于日常使用的文档图像颜色较为单一，因此该方法容易达到较高的压缩比率。对于未经处理过的文件，基本可以实现 50% 甚至 30% 以下的压缩效果。

![Untitled](Docx%20%E5%92%8C%20pptx%20%E6%96%87%E6%A1%A3%E7%9A%84%E5%86%8D%E5%8E%8B%E7%BC%A9%20b16f9c8dad28457c88feada4d9b95cdf/Untitled%203.png)

![Untitled](Docx%20%E5%92%8C%20pptx%20%E6%96%87%E6%A1%A3%E7%9A%84%E5%86%8D%E5%8E%8B%E7%BC%A9%20b16f9c8dad28457c88feada4d9b95cdf/Untitled%204.png)

[Gradio](https://www.gradio.app/)