## 降维打击-四元数

欧拉四元数简直是神迹，
用四维的形式解决三维的问题。

在四元数规范下，
我们将看到内积和外积对应同一个方程的实部和虚部，
也因此，三维世界的解析几何经典公式在四维世界中成对出现。

这也是目前主要的计算机视觉工具在处理三维空间几何计算问题时，
使用四元数对空间坐标进行表示的原因。

---

- [降维打击-四元数](#降维打击-四元数)
- [虚数与四元数](#虚数与四元数)
- [四元数的并乘](#四元数的并乘)
- [双胞胎](#双胞胎)
  - [第一个例子](#第一个例子)
  - [第二个例子](#第二个例子)

## 虚数与四元数

欧拉提出了虚数单位i的概念，
解决了如何表示在实数轴之外的，全部代数方程的根、
如何将旋转表示成代数问题等等数学困难。

四元数是对虚数概念的三维拓展。

$$A = a_0 + a_i i + a_j j + a_k k$$

其中，$i, j, k$是相互正交的“虚数”单位，满足

$$ i^2 = j^2 = k^2 = -1 \\ ij=k, jk=i, ki=j \\ ij=-ji, jk=-kj, ki=-ik $$

这是纯粹的数学概念，
让我们给他赋予一点现实意义。
$i, j, k$代表笛卡尔坐标系的三个轴，
对于三维空间中的一个点，
$a_i, a_j, a_k$代表点的向量表示，

$$\vec{a} = [a_i, a_j, a_k]$$

$a_0$代表这个点的某个特征，
如果我们只是为了表示某个点，
$a_0$值通常取零。

下面的分析可以看到，
在这样的定义方式下，
四元数可以与三维几何拓扑中的内积和外积概念，完美的对应起来。

## 四元数的并乘

借用张量分析里“并乘”的概念，
我们将四元数的内积用“并写”的方式展示出来

$$A \Beta = (a_0 b_0 - \vec{a} \cdot \vec{b}) + (a_0 \vec{b} + b_0 \vec{a} + \vec{a} \times \vec{b})$$

其中，两个括号并没有实际意义，
只是为了标记一个现象，
前一个括号代表四元数的“实部”，
后一个括号代表四元数的“虚部”。

可以看到，并乘计算与内积计算过程是相同的，
虽然如此，
但这里使用这么麻烦的方式来表达“内积”不止是为了装X，
而是确有考量。

因为实向量的内积一般为实数，
而四元数的内积却仍然是四元数。
也就是说，四元数的并乘计算，
对四元数集合是封闭的。
这是与内积完全不同的性质。

另外，从实用角度考虑，
四元数的并乘与内积在计算符号上也应有所区别，
从而方便数学表达式的撰写。

在明确了并乘符号的意义之后，
我们观察并乘结果的实部和虚部，
可以看到，在$a_0 = 0$的前提下，
两个四元数并乘的实部等于它们的内积，
而虚部等于它们的外积，
且满足计算关系如下

$$\mathcal{Real} = \vec{a} \cdot \vec{b}\\ \mathcal{Imag} = \vec{a} \times \vec{b}$$

此时，我们发现只要计算四元数的并乘，
就可以同时得到向量的内积和外积，
这是相当简洁和漂亮的结果。

## 双胞胎

不难验证，四元数的并乘满足结合律，
但不满足交换律，
因此可以说四元数集合构成群。
这个群可以有效地解决三维向量的复杂方程，
而且它们几乎总是以“双胞胎”的形式成对出现的。

利用结合律性质，
我们可以将三维空间中的经典几何等式，
以成对的方式进行推导。

首先将$\nabla$算子表示为四元数的形式

$$\nabla_4 = 0 + i \frac{\partial}{\partial x_i} + j \frac{\partial}{\partial x_j}+ k \frac{\partial}{\partial x_k} = 0 + \nabla $$

它与其他四元数的并乘结果如下

$$\nabla_4 A = -\nabla \cdot \vec{a} + \nabla \times \vec{a}$$

并且，它的二次方为

$$\nabla_4 \nabla_4 = - \nabla \cdot \nabla = - \nabla^2$$

下面尝试用用两个例子来说明以上的结果的应用

### 第一个例子

利用四元数的结合律，有下式

$$\nabla_4 \nabla_4 A = (\nabla_4 \nabla_4) A = \nabla_4 (\nabla_4 A)$$

其中，左式为

$$(\nabla_4 \nabla_4) A = - \nabla^2 \vec{a}$$

注意到它的实部为零，虚部非零。

右式为

$$\nabla_4 (\nabla_4 A) = \nabla_4 (- \nabla \cdot \vec{a} + \nabla \times \vec{a})_4$$

展开得

$$\nabla_4 (\nabla_4 A) = - \nabla (\nabla \cdot \vec{a}) - \nabla \cdot (\nabla \times \vec{a}) + \nabla \times (\nabla \times \vec{a})$$

由于它与左式相等，因此利用对应项相等，有

$$\nabla \cdot (\nabla \times \vec{a}) = 0 \\ \nabla \times (\nabla \times \vec{a}) = \nabla (\nabla \cdot \vec{a}) - \nabla^2 \vec{a}$$

这样，就莫名其妙地推导出了两个重要公式，
尤其是第二个公式，实属是在三维空间中非常难以证明的玩意。

### 第二个例子

引入标量场$\psi$，它的四元数表示为

$$\Psi = \psi + 0 i + 0 j + 0 k$$

考虑被其加权的向量场

$$\Psi A = 0 + \psi (a_i i + a_j j + a_k k)$$

当然，在三维空间中，它的表示相当的简单

$$\psi \vec{a}$$

采用了麻烦的四元数表示方法之后，
它将会给我们带来什么呢？
让我们来考虑以下微分式，
将复合函数的微分展开得

$$\nabla_4 (\Psi A) = \nabla_4 \Psi A+ \Psi \nabla_4 A$$

对它的左侧进行展开，得到

$$\nabla_4 (\Psi A) = - \nabla \cdot (\psi \vec{a}) + \nabla \times (\psi \vec{a})$$

将右式展开，分别得到实部和虚部，得到

实部

$$-\nabla \psi \cdot \vec{a} - \psi \nabla \cdot \vec{a}$$

虚部

$$\nabla \psi \times \vec{a} + \psi \nabla \times \vec{a}$$

这样，就可以得到另外两个重要结论

$$\nabla \times (\psi \vec{a}) = \nabla \psi \times \vec{a} + \psi \nabla \times \vec{a}$$

以及

$$\nabla \cdot (\psi \vec{a}) = \nabla \psi \cdot \vec{a} + \psi \nabla \cdot \vec{a}$$

通过以上两个例子可以看到，
从四元数的升维空间，
可以方便地解决一些三维空间的解析几何问题。

这也是目前主要的计算机视觉工具在处理三维空间几何计算问题时，
使用四元数对空间坐标进行表示的原因。