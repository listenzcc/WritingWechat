## 我们与真相的距离

俗话说“众口难调”，要摸底某个群体的真实情况往往是十分困难和意义重大的事情。
那么，我们需要调研多少个样本，才能在较高的置信度下，确定该群体的真实情况呢？
本文将通过概率分析方法，尝试分析并解决这一问题。
那么，这个调研样本的数量要求，就是“我们与真相的距离”。

---
- [我们与真相的距离](#我们与真相的距离)
- [问题](#问题)
  - [问题的描述](#问题的描述)
  - [问题的抽象](#问题的抽象)
- [抽样游戏](#抽样游戏)
  - [有放回抽样](#有放回抽样)
  - [无放回抽样](#无放回抽样)

## 问题

想象一个黑箱，里面装有$N$个同质圆球。
这些球代表不同的分值，有$m$种分值可选。
我们的目的，是通过有限的采样，确定这些球的平均分值。

这样的问题的研究价值吗？
当然有。

- 在民意调查中，我们可以假定$N$是人口总数，投票$1$分代表赞成，$0$代表反对，则平均分代表赞成的比例；
- 在市场调研中，分数可以代表目标人群对目标产品的心理价位、满意度、风险期望等多种关键商业指标。

因此，当我们的目的是对“平均分”进行估计的情况下，确定采样数量是十分关键的问题。

### 问题的描述

由我的《概然而非必然的世界》系列文章的分析可以看到，通过计算样本均值的方法，可以对“平均分”进行估计。
但这种“估计”的误差则与样本方差有关。
而样本方差又受到与采样规模的影响，因此我们需要采用合适的样本规模，才能以较高的置信水平，相信我们得到的样本均值是总体均值的真实反应。

总之，我解决“平均分”估计的问题，需要确定高置信水平所需要的样本规模。

### 问题的抽象

为了有利于问题的解决，我们需要原问题进行数学抽象。

已知随机变量$X$，其概率密度函数为

$$ X \sim \{P(X=x_i) = \psi_i\} $$

总体均值可以表示为

$$ \mu = \frac{1}{N}\sum_{i=1}^{N} x_i = \frac{1}{N} \sum_{i=1}^{m} \xi_i n_i $$

其中，$\xi_i$和$n_i$分别代表所有可能的取值及其数量。

总体方差可以表示为

$$ \delta^2 = \frac{1}{N}\sum_{i=1}^{N} (x_i - \mu)^2 = \frac{1}{N} \sum_{i=1}^{m}\xi_i^2n_i - \mu^2 $$

我们的目的是通过采样，对$\mu$进行估计，
使得误差值大于$d$的概率小于置信度$\alpha$。

$$ \mathbb{P}(|\hat{\mu} - \mu| > d) < \alpha $$

其中，$\hat{\mu}$代表估计值，$d$和$\alpha$是范围内的指定值。

为了将问题的形式与“中心极限定理”的形式靠拢，我们采用如下变换

$$ \mathbb{P}(\frac{|\hat{\mu} - \mu|}{\Delta} > z) < \alpha $$

其中，$z$代表样本Z分数分布（偶尔近似于正态分布）条件下，置信度$\alpha$值所对应的分位数，$\Delta$是方差项的代位

$$ \Delta = \frac{d}{z} $$

由“中心极限定理”可得，要满足不等式关系，我们需要增加采样规模，直到满足下式

$$ \mathcal{V} (\bar{X}) \le \frac{d^2}{z^2} $$

因此，原问题转变成了采样规模的游戏。
扣一下题，这个采样规模，就是“我们与真相的距离”。

## 抽样游戏

### 有放回抽样

而为了估计样本规模，我们需要分“有放回抽样”和“无放回抽样”两种情况，分别进行讨论。

其中，“有放回抽样”属于简单的情况，因为样本总体不会随“抽样行为”的进行而发生变化。

其样本均值的方差，可以用下式表示

$$ \mathcal{V}(\bar{X}) = \frac{1}{n} \delta^2 $$

其中，$n$代表采样规模，$\delta^2$代表总体方差。

则采样规模$n$，可以通过下式进行确定

$$ \frac{1}{n}\delta^2 = \frac{d^2}{z^2} $$

这是非常直接明了的线性下降关系。

### 无放回抽样

无放回抽样的难点在于，在样本总体有限的情况下，
随着抽样过程的进行，样本的总量和不同取舍的比例都是动态变化的。
其方差为

$$ \frac{N-n}{N-1} \frac{1}{n}\delta^2 $$

其中，$n$为采样规模。
可见，在“无放回抽样”条件下，其方差总是大于“有放回抽样”的情况，且当$N \rightarrow \infty$的条件下，二者是等价的。
这种方差放大的效应，正是由于样本总体不断动态变化所导致的。
接下来，我们需要证明它。

由于方差属于二阶矩统计量，因此，我们只需考虑相邻的两次抽样即可。
其概率密度函数为

- 情况一，相邻两次（$i, j$）采样值不同

    $$ \mathbb{P}(X_i=\xi_s, X_j=\xi_r) = \frac{n_s}{N} \frac{n_r}{N-1}, s \neq r $$

- 情况二，相邻两次（$i, j$）采样值相同

    $$ \mathbb{P}(X_i=\xi_s, X_j=\xi_s) = \frac{n_s}{N} \frac{n_s-1}{N-1} $$

接下来，我们将样本均值的方差表示为协方差的形式

$$ \mathcal{V}(\bar{X}) = \mathcal{E} (Cov(X_i, X_j)) $$

变量的方差同样可以表示为协方差的形式

$$ \mathcal{V}(X_i) = Cov(X_i, X_j) $$

经过简单推导

$$ \mathcal{V}(\bar{X}) = \frac{1}{n^2} \sum_{i, j}Cov(X_i, X_j) = \frac{1}{n^2} (\sum_{i=j}^{n} \mathcal{V}(X_i) + \sum_{i \neq j}Cov(X_i, X_j)) $$

则有

$$ \mathcal{V}(\bar{X}) = \frac{1}{n}\delta^2 + \frac{n-1}{n}Cov(X_i, X_j) $$

为了求得协方差的值，我们对两个变量的联合分布进行分析，有

$$ \mathcal{E}(X_i, X_j) = \sum_{k, l} \xi_k \xi_l p_{kl} = \mu^2 - \frac{1}{N-1}\delta^2 $$

因此，由

$$ Cov(X_i, X_j) = E(X_i, X_j) - \mu^2 $$

可得

$$Cov(X_i, X_j) = - \frac{1}{N-1}\delta^2$$

则有


$$ \mathcal{V}(\bar{X}) = \frac{1}{n} \delta^2 (1 - \frac{n-1}{N-1})$$

证明完毕。

其中细节可见[Simple Random Sampling](http://dept.stat.lsa.umich.edu/~moulib/sampling.pdf "Simple Random Sampling")。



