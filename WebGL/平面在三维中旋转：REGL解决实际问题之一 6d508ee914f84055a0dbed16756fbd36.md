# 平面在三维中旋转：REGL解决实际问题之一

这是一个平面在三维空间中旋转并通过仿射变换反映在二维空间的问题。通过对平面进行维度扩展和仿射变换的数学建模，介绍了如何处理三维空间中的旋转问题，并尝试从二维空间的信息中反推三维空间的信息。然而，由于信息的不完整性，这个问题成为了一个欠定问题，特别是当只能从二维空间中提取到部分信息时。

为了解决这个问题，采用了REGL进行模拟实验，设计了一个二维矩形在三维空间中的旋转模拟，并记录下角点的位置变化。通过对这些数据进行回归分析，我尝试了解是否可以仅通过仿射变换后的三个角点的二维坐标来推断出第四个角点的二维坐标。实验结果显示，虽然无法准确推测出第四个角点的第三维$z$成分，但如果只关注二维平面内的位置，通过三个角点的信息反推第四个角点的二维坐标是可行的。

实验代码可见：

[Geometry Dim 2 to 3](https://observablehq.com/@listenzcc/geometry-dim-2-to-3)

分析代码可见：

[https://github.com/listenzcc/geometry-dim-2-to-3](https://github.com/listenzcc/geometry-dim-2-to-3)

---
[toc]

## 平面在三维空间旋转

在二维空间中可以定义一个平面，即不共线的两个二维向量的线性组合构成的点集

$$
\begin{cases}
v=\alpha v_1 + \beta v_2 & v_1, v_2 \in \mathbb{R}^2 \\
v_1 \neq \delta v_2 & \delta \in \mathbb{R}
\end{cases}
$$

当这个平面在三维空间中旋转时，需要给向量赋予第三个维度的值$z\in\mathbb{R}$，

$$
u = \begin{bmatrix}v\\z\end{bmatrix}, u \in \mathbb{R}^3
$$

我在之前的内容介绍过空间运动映射的基本原理，由这些原理可知，如果要让这些点在三维空间中旋转起来，并加上平移或缩放等操作，那么需要将向量进一步增广，得到$w\in\mathbb{R}^4$

$$
w = \begin{bmatrix}u\\1\end{bmatrix}, w\in \mathbb{R}^4
$$

此时，对该向量进行的任何仿射操作都可以表示成变换矩阵连乘的形式

$$
w'=F_1\cdot F_2 \cdots w=F^4\cdot w, F^4\in \mathbb{R}^{4\times4}
$$

多个矩阵连乘代表按顺序进行若干次仿射变换操作，且变换矩阵连乘不改变左乘矩阵的变换形式。这是平面在三维空间旋转的最简表示。

## 解不出来的第三个维度

即使在这个最简表示之下，我发现仍然难以通过仅有的二维信息反解出全部三维信息。举个例子，你眼前的电脑或手机屏幕是一个有边界的二维平面，当它在三维上发现旋转时给它照相，虽然物体是三维的，但照片是二维的。在照片中，它的形状会从最初的矩形逐渐变成菱形，甚至只剩下一条线，这就是仿射变换造成的影响。

我想要做的，是从二维照片的“菱形块”中，将这个屏幕及屏幕上的内容还原到标准矩形的形式。我知道，如果我能准确定位菱形块的四个角点，那么使用二维仿射变换就可以还原出来。因为我只要将原点定义成其他的点，那么这四个角点对应四个线性无关的向量，可以求解$F^4$

$$
F^4w=w' \rightarrow\hat{w}=G^4w', G\cdot F=I
$$

但我的困难是信息不全，在照片中，我有时只能提取到三个角点，于是这就成了一个没有固定解的欠定问题。

### 如果我不需要第三个维度呢？

虽然整个问题是欠定的，但这些解之间却有线性关系。如果我只关心$v$，而不关心第三个维度$z$的值呢？那么能否仅根据三个角点反推出第四个角点的$v$值呢？毕竟二维矩形是不变的，不是吗。

## REGL模拟实验与分析

由于在这个问题上，我的脑子不怎么够用，所以我就简单粗暴地模拟它。模拟的手段是REGL。即在软件中设计一个二维矩形，之后让它在三维空间中旋转，并在过程中随时记录角点的位置，得到的数据进行回归分析，看看我能不能以某三个角点为自变量，将第四个角点的坐标回归出来。为了简单起见，我将二维矩形的一个角点设定在零点上。

从如下动图可见，在该矩形旋转时，角点的位置被实时记录下来。由于我将拍摄者的正方向设置为固定向上，它与矩形对角线方向（黄色区域所在方向）在同一平面上，因此不管拍摄者如何运动，该点在$u$变量上的轨迹总在一条直线上，如右图中墨绿色点所示。

![20240302-101852.gif](%E5%B9%B3%E9%9D%A2%E5%9C%A8%E4%B8%89%E7%BB%B4%E4%B8%AD%E6%97%8B%E8%BD%AC%EF%BC%9AREGL%E8%A7%A3%E5%86%B3%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98%E4%B9%8B%E4%B8%80%206d508ee914f84055a0dbed16756fbd36/20240302-101852.gif)

如果我将拍摄者的正方向随机化，那么就得到类似下图的效果。

![Untitled](%E5%B9%B3%E9%9D%A2%E5%9C%A8%E4%B8%89%E7%BB%B4%E4%B8%AD%E6%97%8B%E8%BD%AC%EF%BC%9AREGL%E8%A7%A3%E5%86%B3%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98%E4%B9%8B%E4%B8%80%206d508ee914f84055a0dbed16756fbd36/Untitled.png)

### 回归分析结果

在回归分析过程中，自变量是P1和P3点的轨迹，因变量是P2点的轨迹

$$
\hat{u}_{p2}=\psi(u_{p1}, u_{p3})
$$

下图左侧子图代表这些轨迹的分布，一张对应拍摄者正方向不变的结果，另一线对应拍摄者正方向随机的结果。右侧子图是回归误差。误差分为三列，前两列（也就是没有误差的两列）分别代表$v$成分的误差，第三列（也就是误差大的一列）代表$z$成分的误差。

![data1.jpg](%E5%B9%B3%E9%9D%A2%E5%9C%A8%E4%B8%89%E7%BB%B4%E4%B8%AD%E6%97%8B%E8%BD%AC%EF%BC%9AREGL%E8%A7%A3%E5%86%B3%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98%E4%B9%8B%E4%B8%80%206d508ee914f84055a0dbed16756fbd36/data1.jpg)

![data2.jpg](%E5%B9%B3%E9%9D%A2%E5%9C%A8%E4%B8%89%E7%BB%B4%E4%B8%AD%E6%97%8B%E8%BD%AC%EF%BC%9AREGL%E8%A7%A3%E5%86%B3%E5%AE%9E%E9%99%85%E9%97%AE%E9%A2%98%E4%B9%8B%E4%B8%80%206d508ee914f84055a0dbed16756fbd36/data2.jpg)

分析结果表明，如果我只对第四个角点的$v$值感兴趣，那么仅通过仿射变换后的三个角点的$v$坐标是能够反推出它的。但线性方法不能有效地推测出第四个角点的$z$成分。