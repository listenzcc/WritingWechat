## 方差分析（五）

除了之前介绍的情况之外，
样本变量之间的协方差也是影响方差分析的难点之一。
本文继续进行实验。

---

- [方差分析（五）](#方差分析五)
- [数据构造](#数据构造)
- [方差分析](#方差分析)

## 数据构造

由于前面有诸多铺垫，
在此直接介绍本文的数据构造方式。

本文构造的数据具有较为极端的性质，

- 两个类别的样本具有**完全相同**的分布；
- 两个类别的样本同样具有极其紧密的联系。

具体的方法是构造两个相互独立的正态分布数据

$$X_1 \in \mathcal{N}(0, 1)$$

且

$$X_2 \in \mathcal{N}(0, 1)$$

在构造过程中，它们是完全独立的

```python
# Generate Independent Datasets v1 and v2
import numpy as np 
v1 = np.random.randn(num)
v2 = np.random.randn(num)
```

之后，将它们进行“融合”

$$D_1 = X_1 + X_2$$

另一组数据是

$$D_2 = X_1 - X_2$$

由于均值为零，
且方差满足可加性，
因此可以认为

$$D_i \in \mathcal{N}(0, \delta^2)$$

其中，方差$\delta^2$的取值随变量之间的相关性而变化，
在本实验中，它为恒定值$2$。
它们的值的分布如下

![Raw](./anova-5-raw.png)

其中，蓝色是以$1000$为分界点，左右的数据分别为$D_1$和$D_2$;
红色是打乱顺序的数据。
看上去，左右的数据分布真的毫无规律可言。

## 方差分析

从第$500$个数据，到第$1500$个数据进行左右分类，
并对两类进行方差分析，却可以看到明显的区别

![Var-3D](./anova-5-var-3d.png)

可以看到，随着分类点的移动，方差分析的指标同样呈现规律性，
在二维空间的映射更加直观

![Var-2D](./anova-5-var-2d.png)

其中，两个坐标轴分为代表“两类”的方差大小，
颜色代表`F`值。
相似的颜色在该空间中呈现“聚团”特性，
这说明，
方差分析能够在这组数据中，找到潜在的分割点。

而前面在生成数据时已经说明，
两类数据并没有统计量上的差异，
只是具有较强的协变关系。

这说明

> 数据之间的协变关系，也是导致方差分析出现“错误”的诱因。

这一点相当的可怕，
因为使用方差分析对类别之间的差异进行检验的时候，
我们希望它能够找到“均值”差异，
但如果两个实验条件，同时受到某个协变量的影响，
导致它们之间的协变关系较强，
就很容易导致错判。

事实上，很多经典的实验数据解读的错误就是这么发生的。